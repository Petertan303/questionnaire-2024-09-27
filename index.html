<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>霸凌总是令人心痛的……</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">欢迎参加我们的问卷调查</h2>

        <form id="survey-form">
            <div class="form-group">
                <label for="question1">问题1: 单选题示例 (请选择一个)</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question1" id="question1_1" value="option1">
                    <label class="form-check-label" for="question1_1">选项1</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question1" id="question1_2" value="option2">
                    <label class="form-check-label" for="question1_2">选项2</label>
                </div>
            </div>

            <div class="form-group">
                <label for="question2">问题2: 多选题示例 (可多选)</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="question2" id="question2_1" value="option1">
                    <label class="form-check-label" for="question2_1">选项1</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="question2" id="question2_2" value="option2">
                    <label class="form-check-label" for="question2_2">选项2</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">提交问卷</button>
        </form>

        <div id="survey-status" style="display: none;">
            <h4>问卷已提交！</h4>
        </div>
    </div>

    <script src="jquery-1.11.0.min.js"></script>
    <script>
        $(document).ready(function() {
            const apiBaseUrl = 'https://frp-few.top:57576/';

            $('#survey-form').on('submit', async function(event) {
                event.preventDefault();

                // 获取IP地址并MD5加密
                const response = await fetch('https://ip.011102.xyz/');
                const data = await response.json();
                const ip = data.IP.IP;
                const md5Ip = CryptoJS.MD5(ip).toString();

                const formData = $(this).serializeArray();
                const jsonData = {};
                formData.forEach(function(item) {
                    jsonData[item.name] = item.value;
                });

                // 添加md5Ip到jsonData
                jsonData.md5Ip = md5Ip;

                $.ajax({
                    url: `${apiBaseUrl}/submit_survey/`,
                    type: 'POST',
                    data: JSON.stringify(jsonData),
                    contentType: "application/json",
                    success: function(response) {
                        alert('感谢您的参与！');
                        $('#survey-form').hide();
                        $('#survey-status').show();
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        alert('提交失败，请重试。');
                    }
                });
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
</body>

</html>