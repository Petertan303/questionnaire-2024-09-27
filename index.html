<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>霸凌总是令人心痛的……</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<div class="container mt-5">
    <h2 class="mb-4">欢迎参加我们的问卷调查</h2>

    <div id="survey-status" style="display:none;">
        <p>您已经完成了本次问卷调查，感谢您的参与！</p>
    </div>

    <form id="survey-form" style="display:none;">
        <div class="form-group">
            <label for="question1">问题1: 单选题示例 (请选择一个)</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question1" id="question1_1" value="option1">
                <label class="form-check-label" for="question1_1">选项1</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question1" id="question1_2" value="option2">
                <label class="form-check-label" for="question1_2">选项2</label>
            </div>
        </div>

        <div class="form-group">
            <label for="question2">问题2: 多选题示例 (可多选)</label>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="question2" id="question2_1" value="option1">
                <label class="form-check-label" for="question2_1">选项1</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="question2" id="question2_2" value="option2">
                <label class="form-check-label" for="question2_2">选项2</label>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">提交问卷</button>
    </form>
</div>

<script>
    $(document).ready(function() {
        // 检查IP地址是否已经完成问卷
        $.ajax({
            url: '/check_ip',
            type: 'POST',
            data: JSON.stringify({
                ip_address: '{{ request.remote_addr }}'
            }),
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                if (data.completed) {
                    $('#survey-form').hide();
                    $('#survey-status').show();
                } else {
                    $('#survey-form').show();
                }
            },
            error: function() {
                alert('检查IP地址时出错，请重试。');
            }
        });

        // 提交问卷
        $('#survey-form').on('submit', function(event) {
            event.preventDefault();

            var formData = $(this).serializeArray();
            formData.push({
                name: 'ip_address',
                value: '{{ request.remote_addr }}'
            });

            $.ajax({
                url: '/submit_survey',
                type: 'POST',
                data: JSON.stringify(formData),
                contentType: 'application/json; charset=utf-8',
                success: function(response) {
                    alert('感谢您的参与！');
                    $('#survey-form').hide();
                    $('#survey-status').show();
                },
                error: function() {
                    alert('提交失败，请重试。');
                }
            });
        });
    });
</script>
<script src="static/profile/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="bs-init.js"></script>
<script src="chart.min.js"></script>
<script src="jquery-1.11.0.min.js"></script>
</body>

</html>